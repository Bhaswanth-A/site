<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"><title>TF101 - Automation & Robotics Club</title>

<meta name="description" content="Basics of ROS ecosystem have been covered">
<link rel="canonical" href="https://arc-bphc.github.io/site/projects/2021-05-04-ROS-TF101.html"><link rel="alternate" type="application/rss+xml" title="Automation & Robotics Club" href="/site/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/site/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/site/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/site/assets/favicon-16x16.png"><link rel="manifest" href="/site/assets/site.webmanifest"><link rel="mask-icon" href="/site/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/site/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/site/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/site/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<!-- Jekyll Ideal Image Slider Include -->
<!-- https://github.com/jekylltools/jekyll-ideal-image-slider-include -->
<!-- v1.8 -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
<!-- Jekyll Ideal Image Slider Include -->
<!-- https://github.com/jekylltools/jekyll-ideal-image-slider-include -->
<!-- v1.8 --></script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/site/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand">
          <div class="header__brand">
            <img src="/site/assets/images/logo/logo.png"/><a
              title="Automation & Robotics Club, BITS Pilani Hyderabad Campus
"
              href="/site/">
            </a></div><a title="Automation & Robotics Club, BITS Pilani Hyderabad Campus
" href="/site/">Automation & Robotics Club</a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul>
          <!--<li class="navigation__item"><a href="/site/projects/">Projects</a></li><li class="navigation__item"><a href="/site/resources/">Resources</a></li><li class="navigation__item"><a href="/site/blog/">Blog</a></li><li class="navigation__item"><a href="/site/archive/">Archive</a></li><li class="navigation__item"><a href="https://arc-bphc.github.io#about">About</a></li>-->
          <!-- <div class="navbar">
            <a href="/site/projects/">Projects</a>
            <a href="/site/resources">Resources</a>
            <a href="/site/blog">Blog</a>
            <a href="https://arc-bphc.github.io#about">About</a>
            <div class="dropdown">
              <button class="dropbtn">Others 
                <i class="fa fa-caret-down"></i>
              </button>
              <div class="dropdown-content">
                <a href="/site/archive">Archive</a>
                <a href="#">Our Team</a>
                <a href="#">Publications</a>
                <a href="#">Skill Tree</a>
              </div>
            </div> 
          </div> -->
          <div class="topnav" id="myTopnav">
            <a href="/site/projects/" class="active">Projects</a>
            <a href="/site/resources">Resources</a>
            <a href="/site/blog">Blog</a>
            <div class="dropdown">
              <button class="dropbtn">Others 
                <i class="fa fa-caret-down"></i>
              </button>
              <div class="dropdown-content">
                <a href="/site/archive">Archive</a>
                <a href="#">Our Team</a>
                <a href="#">Publications</a>
                <a href="#">Skill Tree</a>
              </div>
            </div> 
            <a href="https://arc-bphc.github.io#about">About</a>
            <a href="javascript:void(0);" style="font-size:15px;" class="icon" onclick="myFunction()">&#9776;</a>
          </div><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>

<script>
function myFunction() {
  var x = document.getElementById("myTopnav");
  if (x.className === "topnav") {
    x.className += " responsive";
  } else {
    x.className = "topnav";
  }
}
</script>

<style>
body {margin:0;font-family:Arial}

.topnav {
  overflow: hidden;
  background-color: #202020;
}

.topnav a {
  float: left;
  display: block;
  color: #202020;
  text-align: center;
  padding: 3px 5px;
  text-decoration: none;
  font-size: 16px;
}

.active {
  color: #202020;
}

.topnav .icon {
  display: none;
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 16px;    
  border: none;
  outline: none;
  padding: 3px 5px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #202020;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  float: none;
  color: #202020;
  padding: 3px px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.topnav a:hover, .dropdown:hover .dropbtn {
  background-color: #202020;
  color: #ff9500;
}

.dropdown-content a:hover {
  background-color: #202020;
  color: black;
}

.dropdown:hover .dropdown-content {
  display: block;
}

@media screen and (max-width: 600px) {
  .topnav a:not(:first-child), .dropdown .dropbtn {
    display: none;
  }
  .topnav a.icon {
    float: right;
    display: block;
  }
}

@media screen and (max-width: 600px) {
  .topnav.responsive {position: relative;}
  .topnav.responsive .icon {
    position: absolute;
    right: 0;
    top: 0;
  }
  .topnav.responsive a {
    float: none;
    display: block;
    text-align: left;
  }
  .topnav.responsive .dropdown {float: none;}
  .topnav.responsive .dropdown-content {position: relative;}
  .topnav.responsive .dropdown .dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}
</style>
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
<!-- <style>
body {
  font-family: Arial, Helvetica, sans-serif;
}

.navbar {
  overflow: hidden;
  background-color: #202020;
}

.navbar a {
  float: left;
  font-size: 16px;
  color: #202020;
  text-align: center;
  padding: 3px 5px;
  text-decoration: none;
}

.dropdown {
  float: left;
  overflow: hidden;
}

.dropdown .dropbtn {
  font-size: 16px;  
  border: none;
  outline: none;
  padding: 3px 5px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}

.navbar a:hover, .dropdown:hover .dropbtn {
  background-color: #202020;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #202020;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  float: none;
  color: black;
  padding: 3px 5px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.dropdown-content a:hover {
  background-color: #202020;
}

.dropdown:hover .dropdown-content {
  display: block;
}
</style> --></div><div class="page__content"><img class="article__header--cover" src="/site/screenshot.jpg" /><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>TF101</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/arc-bphc/site/tree/master/_projects/2021-05-04-ROS-TF101.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="TF101"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/site/archive/# "archive/" (default)?tag=ros">ros</a>
            </li></ul></div><meta itemprop="author" content="Automation  & Robotics Club"/><meta itemprop="datePublished" content="2021-05-04T16:17:25+05:30">
    <meta itemprop="keywords" content="ros"><div class="js-article-content"><!-- Jekyll Ideal Image Slider Include -->
<!-- https://github.com/jekylltools/jekyll-ideal-image-slider-include -->
<!-- v1.8 -->


<!-- Jekyll Ideal Image Slider Include -->
<!-- https://github.com/jekylltools/jekyll-ideal-image-slider-include -->
<!-- v1.8 --><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><p>Basics of ROS ecosystem have been covered
<!--more-->
<strong>Contents</strong>: Visulization of TF, Publishing, Broadcasting &amp; Listening to TF, Static Transform, Joint and Robot State Publishers.</p>

<hr />
<p>A transform specifies how data expressed in a frame can be transformed into a different frame. For instance, if you detect an obstacle with the laser at 3 cm in the front, this means that it is 3 cm from the laser, but not from the center of the robot (that is usually called the /base_link). To know the distance from the center of the robot, you need to transform the 3 cm from the /laser_frame to the /base_link frame (which is actually what the Path Planning system needs to know, what is the distance from the center of the robot to the obstacle).</p>

<p>First, we’ll define two frames (coordinate frames), one at the center of the laser and another one at the center of the robot. Usually, the center of the robot is placed at the rotational center of the robot. We’ll name the laser frame as base_laser and the robot frame as base_link.</p>

<p>Now, we need to define a relationship (in terms of position and orientation) between the base_laser and the base_link. For instance, we know that the base_laser frame is at a distance of 20 cm in the y axis and 10 cm in the x axis referring the base_link frame. Then we’ll have to provide this relationship to the robot. This relationship between the position of the laser and the base of the robot is known in ROS as the TRANSFORM between the laser and the robot.</p>

<h2 id="visulization-of-tf">Visulization of TF</h2>
<h3 id="view_frames">View_frames</h3>
<p>The view_frames ROS node generates a diagram with the current TF tree of the system.</p>

<p><code class="language-plaintext highlighter-rouge">rosrun tf view_frames</code></p>

<h3 id="rqt_tf_tree">rqt_tf_tree</h3>
<p>rqt_tf_tree gives the same functionality as the view_frames, with an interesting extra: you can refresh and see changes without having to generate another PDF file each time.</p>

<p><code class="language-plaintext highlighter-rouge">rosrun rqt_tf_tree rqt_tf_tree</code></p>

<h3 id="using-echo-tf">Using echo /tf</h3>
<p>There is a topic named /tf where all the TFs are published. The only problem is that ALL of them are published. In simple systems like this one, that isn’t a problem; but in massive systems, the quantity of data can be overwhelming. Therefore, the tf package gives a handy tool that filters which transform you are interested in and just shows you that one.</p>

<p><code class="language-plaintext highlighter-rouge">rostopic echo -n1 /tf</code></p>

<h3 id="using-tf_echo">Using tf_echo</h3>
<p>The /tf topic only publishes the direct TFs, not all the transforms between all the frames. tf_echo does return the transforms between any connected frames to you.</p>

<p><code class="language-plaintext highlighter-rouge">rosrun tf tf_echo [reference_frame] [target_frame]</code></p>

<h2 id="tf-publisher-broadcaster-listener-subscriber">TF Publisher, Broadcaster, Listener, Subscriber</h2>
<h3 id="tf-publisher">TF Publisher</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span><span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">tf2_ros</span>
<span class="kn">from</span> <span class="nn">tf2_msgs.msg</span> <span class="kn">import</span> <span class="n">TFMessage</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">TransformStamped</span>


<span class="n">rospy</span><span class="p">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">'fixed_tf2_broadcaster'</span><span class="p">)</span>

<span class="n">pub_tf</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">"/tf"</span><span class="p">,</span><span class="n">TFMessage</span><span class="p">,</span> <span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">TFMessage</span><span class="p">()</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="n">is_shutdown</span><span class="p">():</span>
     <span class="c1"># Run this loop at about 10Hz
</span>    <span class="n">rospy</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="n">t1</span> <span class="o">=</span> <span class="n">TransformStamped</span><span class="p">()</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"turtle1"</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="s">"carrot1"</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">t2</span> <span class="o">=</span> <span class="n">TransformStamped</span><span class="p">()</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">"turtle1"</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="s">"carrot2"</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">4.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">message</span> <span class="o">=</span> <span class="p">[</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">]</span>
    <span class="n">pub_tf</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="n">rospy</span><span class="p">.</span><span class="n">spin</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="tf-broadcaster-example---1">TF Broadcaster Example - 1</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">handle_turtle_pose</span><span class="p">(</span><span class="n">pose_msg</span><span class="p">,</span> <span class="n">robot_name</span><span class="p">):</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">TransformBroadcaster</span><span class="p">()</span>

    <span class="n">br</span><span class="p">.</span><span class="n">sendTransform</span><span class="p">((</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="n">pose_msg</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="p">),</span>
                     <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>
                     <span class="n">robot_name</span><span class="p">,</span>
                     <span class="s">"/world"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>You have to publish each element of the position and orientation inside a parenthesis, otherwise it might not work.There is also a very important element, which is the rospy.Time.now(). This is because TF really depends on time to make everything work and be able to play with past messages. Then, state the name of the child-frame you want to assign that model (robot_name) and the parent-frame, which, in this case, is /world.</p>

<h3 id="tf-broadcaster-example---2">TF Broadcaster Example - 2</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span><span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">'my_moving_carrot_tf_broadcaster'</span><span class="p">)</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">TransformBroadcaster</span><span class="p">()</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Rate</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">turning_speed_rate</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">to_sec</span><span class="p">()</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">turning_speed_rate</span>
        <span class="c1"># Map to only one turn maximum [0,2*pi)
</span>        <span class="n">rad_var</span> <span class="o">=</span> <span class="n">t</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">br</span><span class="p">.</span><span class="n">sendTransform</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rad_var</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rad_var</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">),</span>
                         <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
                         <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span>
                         <span class="s">"moving_carrot"</span><span class="p">,</span>
                         <span class="s">"turtle2"</span><span class="p">)</span>
        <span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="tf-broadcaster-from-pose-for-turtlesim_node">TF Broadcaster from Pose for turtlesim_node</h3>
<p><strong>NOTE: Requires setting of ROS params in launch file as shown below</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="c">&lt;!--To get the Pose from turtle bot we have to launch turtlesim_node--&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"turtlesim"</span> <span class="na">type=</span><span class="s">"turtlesim_node"</span> <span class="na">name=</span><span class="s">"sim"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"turtle1_tf2_broadcaster"</span> <span class="na">pkg=</span><span class="s">"learning_tf2"</span> <span class="na">type=</span><span class="s">"turtle_tf2_broadcaster.py"</span> <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"turtle"</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">value=</span><span class="s">"turtle1"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="c1">#! /usr/bin/env python
</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">TransformStamped</span>
<span class="kn">from</span> <span class="nn">turtlesim.msg</span> <span class="kn">import</span> <span class="n">Pose</span>
<span class="kn">import</span> <span class="nn">tf_conversions</span>
<span class="kn">import</span> <span class="nn">tf2_ros</span>

<span class="k">def</span> <span class="nf">callback_function</span><span class="p">(</span><span class="n">pose</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">turtlename</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">TransformBroadcaster</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">TransformStamped</span><span class="p">()</span>

    <span class="n">t</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">t</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s">'world'</span>
    <span class="n">t</span><span class="p">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="n">turtlename</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">pose</span><span class="p">.</span><span class="n">x</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">pose</span><span class="p">.</span><span class="n">y</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">translation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">tf_conversions</span><span class="p">.</span><span class="n">transformations</span><span class="p">.</span><span class="n">quaternion_from_euler</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pose</span><span class="p">.</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">t</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">br</span><span class="p">.</span><span class="n">sendTransform</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">'tf2_broadcaster'</span><span class="p">)</span>
    <span class="n">turtlename</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">get_param</span><span class="p">(</span><span class="s">'~turtle'</span><span class="p">)</span>
    <span class="n">rospy</span><span class="p">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s">'/%s/pose'</span><span class="o">%</span> <span class="n">turtlename</span><span class="p">,</span><span class="n">Pose</span><span class="p">,</span><span class="n">callback_function</span><span class="p">)</span>

    <span class="n">rospy</span><span class="p">.</span><span class="n">spin</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="tf-listener">TF Listener</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python  
</span>
<span class="kn">import</span> <span class="nn">rospy</span>
<span class="kn">import</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">tf2_ros</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">rospy</span><span class="p">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">'tf2_turtle_listener'</span><span class="p">)</span>

    <span class="n">tfBuffer</span> <span class="o">=</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">Buffer</span><span class="p">()</span>
    <span class="n">tf2_ros</span><span class="p">.</span><span class="n">TransformListener</span><span class="p">(</span><span class="n">tfBuffer</span><span class="p">)</span>

    <span class="n">turtle_name</span> <span class="o">=</span> <span class="s">"turtle2"</span>

    <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Rate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="p">.</span><span class="n">is_shutdown</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="n">lookup_transform</span><span class="p">(</span><span class="n">turtle_name</span><span class="p">,</span> <span class="s">'turtle1'</span><span class="p">,</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">())</span>
            <span class="c1">#print(trans)
</span>        <span class="k">except</span> <span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
            <span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">()</span>
            <span class="k">continue</span>

        <span class="k">print</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="n">rate</span><span class="p">.</span><span class="n">sleep</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>NOTE: Using <code class="language-plaintext highlighter-rouge">rospy.Time.now()</code> in lookup_transform can cause errors. <code class="language-plaintext highlighter-rouge">rospy.Time.now()</code> &gt; will ask for the frame with the current time, which might always not be avaiable immdeaditly. <code class="language-plaintext highlighter-rouge">rospy.Time()</code> &gt; will ask for the latest frame that is available. To tackle this a time out argument can be given to the lookup_transform,</strong></p>

<p><code class="language-plaintext highlighter-rouge">trans = tfBuffer.lookup_transform(turtle_name, 'turtle1', rospy.Time.now(),rospy.Duration(1.0))</code></p>

<h2 id="time-travel">Time Travel</h2>
<p>To get the tranform between two objects from the past the following can be used.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">past</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="n">lookup_transform</span><span class="p">(</span><span class="n">turtle_name</span><span class="p">,</span> <span class="s">'carrot1'</span><span class="p">,</span> <span class="n">past</span><span class="p">,</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="k">except</span> <span class="p">(</span><span class="n">tf2_ros</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>To get transforms between objects from different timelines the following can be used.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">past</span> <span class="o">=</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">rospy</span><span class="p">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
    <span class="n">trans</span> <span class="o">=</span> <span class="n">tfBuffer</span><span class="p">.</span><span class="n">lookup_transform_full</span><span class="p">(</span><span class="n">target_frame</span><span class="o">=</span><span class="n">turtle_name</span><span class="p">,</span><span class="n">target_time</span><span class="o">=</span><span class="n">rospy</span><span class="p">.</span><span class="n">Time</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">source_frame</span><span class="o">=</span><span class="s">'carrot1'</span><span class="p">,</span><span class="n">source_time</span><span class="o">=</span><span class="n">past</span><span class="p">,</span><span class="n">fixed_frame</span><span class="o">=</span><span class="s">'world'</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="n">rospy</span><span class="p">.</span><span class="n">Duration</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>

<span class="k">except</span><span class="p">(</span><span class="n">tf2_ros</span><span class="p">.</span><span class="n">LookupException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ConnectivityException</span><span class="p">,</span> <span class="n">tf2_ros</span><span class="p">.</span><span class="n">ExtrapolationException</span><span class="p">):</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="robot_state_publisher">robot_state_publisher</h2>
<p>Publishing all the TF’s manually is very tedious and hence ROS provides nice tool called robot state publisher to automate the task for you. In essence, it takes a file describing the morphology of the robot (aka URDF file) as input and it automatically publishes the TF for you.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>

  <span class="c">&lt;!-- Load the URDF file in the param server variable robot_description if it wasn't loaded before --&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Publish TF with robot_state_publisher --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"robot_state_publisher"</span>
    <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">"/joint_states"</span> <span class="na">to=</span><span class="s">"/pi_robot/joint_states"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="joint_state_publisher">joint_state_publisher</h2>
<p>There are two ways to publish non-fixed joint frames</p>

<h3 id="publish-them-directly">Publish them directly</h3>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- send fake joint values --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"joint_state_publisher"</span> <span class="na">pkg=</span><span class="s">"joint_state_publisher"</span> <span class="na">type=</span><span class="s">"joint_state_publisher"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"use_gui"</span> <span class="na">value=</span><span class="s">"TRUE"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span>

  <span class="c">&lt;!-- Combine joint values --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"state_publisher"</span><span class="nt">/&gt;</span>

  <span class="c">&lt;!-- Show in RVIZ   --&gt;</span>
  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"rviz"</span> <span class="na">pkg=</span><span class="s">"rviz"</span> <span class="na">type=</span><span class="s">"rviz"</span> <span class="na">args=</span><span class="s">"-d $(find pi_robot_pkg)/launch/pi_robot.rviz"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>NOTE: This only works in RVIZ, meaning the robot in gazebo won’t be effected by the joint state values.</strong></p>

<h3 id="publish-them-through-hardwaresimulation">Publish them through Hardware/Simulation</h3>
<p><strong>Step 1: Define a joint that isn’t fixed in your URDF File</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"left_shoulder_forward_joint"</span> <span class="na">type=</span><span class="s">"revolute"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">"left_shoulder_link"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">"left_shoulder_forward_link"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">"0 0.025 0"</span> <span class="na">rpy=</span><span class="s">"0 0 0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;limit</span> <span class="na">lower=</span><span class="s">"-1.57"</span> <span class="na">upper=</span><span class="s">"1.57"</span> <span class="na">effort=</span><span class="s">"10"</span> <span class="na">velocity=</span><span class="s">"3"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;axis</span> <span class="na">xyz=</span><span class="s">"0 0 1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;dynamics</span> <span class="na">damping=</span><span class="s">"0.7"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/joint&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Step 2: Define a Transmission for your joint in your URDF File</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;transmission</span> <span class="na">name=</span><span class="s">"tran4"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;type&gt;</span>transmission_interface/SimpleTransmission<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">"left_shoulder_forward_joint"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
    <span class="nt">&lt;/joint&gt;</span>
    <span class="nt">&lt;actuator</span> <span class="na">name=</span><span class="s">"motor4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;hardwareInterface&gt;</span>EffortJointInterface<span class="nt">&lt;/hardwareInterface&gt;</span>
        <span class="nt">&lt;mechanicalReduction&gt;</span>1<span class="nt">&lt;/mechanicalReduction&gt;</span>
    <span class="nt">&lt;/actuator&gt;</span>
<span class="nt">&lt;/transmission&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Step 3: Define the new transmission controller with the name xxx_position_controller (left_shoulder_forward_joint_position_controller) in a configuration yaml file</strong></p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="na">pi_robot</span><span class="pi">:</span>
  <span class="c1"># Publish all joint states -----------------------------------</span>
  <span class="na">joint_state_controller</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">joint_state_controller/JointStateController</span>
    <span class="na">publish_rate</span><span class="pi">:</span> <span class="m">50</span>

  <span class="na">left_shoulder_forward_joint_position_controller</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">effort_controllers/JointPositionController</span>
    <span class="na">joint</span><span class="pi">:</span> <span class="s">left_shoulder_forward_joint</span>
    <span class="na">pid</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">p</span><span class="pi">:</span> <span class="nv">100.0</span><span class="pi">,</span> <span class="nv">i</span><span class="pi">:</span> <span class="nv">0.01</span><span class="pi">,</span> <span class="nv">d</span><span class="pi">:</span> <span class="nv">10.0</span><span class="pi">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Step 4: Start everything through a launch file.</strong></p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>

  <span class="c">&lt;!-- Load the URDF file in the param server variable robot_description if it wasn't loaded before --&gt;</span>
  <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(find pi_robot_pkg)/urdf/pi_robot_v2.urdf"</span> <span class="nt">/&gt;</span>
<span class="c">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span>
  <span class="nt">&lt;rosparam</span> <span class="na">file=</span><span class="s">"$(find pi_robot_pkg)/config/pirobot_control.yaml"</span> <span class="na">command=</span><span class="s">"load"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"controller_spawner"</span>
        <span class="na">pkg=</span><span class="s">"controller_manager"</span>
        <span class="na">type=</span><span class="s">"spawner"</span>
        <span class="na">respawn=</span><span class="s">"false"</span>
        <span class="na">output=</span><span class="s">"screen"</span>
        <span class="na">ns=</span><span class="s">"/pi_robot"</span>
        <span class="na">args=</span><span class="s">"head_pan_joint_position_controller
              head_tilt_joint_position_controller
              torso_joint_position_controller
              left_shoulder_forward_joint_position_controller
              right_shoulder_forward_joint_position_controller
              left_shoulder_up_joint_position_controller
              right_shoulder_up_joint_position_controller
              left_elbow_joint_position_controller
              right_elbow_joint_position_controller
              left_wrist_joint_position_controller
              right_wrist_joint_position_controller
              joint_state_controller"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"robot_state_publisher"</span> <span class="na">pkg=</span><span class="s">"robot_state_publisher"</span> <span class="na">type=</span><span class="s">"robot_state_publisher"</span>
    <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;remap</span> <span class="na">from=</span><span class="s">"/joint_states"</span> <span class="na">to=</span><span class="s">"/pi_robot/joint_states"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/node&gt;</span> 

<span class="c">&lt;!-- &lt;node name="robot_state_publisher" pkg="robot_state_publisher" type="state_publisher"/&gt;--&gt;</span>


<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="static-transforms">Static Transforms</h2>
<p>There are some cases where changing the URDF is not advisable or it simply makes no sense to add it to the robot model.urdf. These are the cases where publishing a static transform, especially through the launch file or commands, is more convenient.</p>

<h3 id="through-command-line">Through Command Line</h3>
<p>The following syntax can be used to publish a static transform via command line. <code class="language-plaintext highlighter-rouge">rosrun tf static_transform_publisher x y z yaw pitch roll frame_id child_frame_id period_in_ms</code></p>

<h3 id="through-launch-files">Through Launch files</h3>
<p>The following syntax can be used to publish a static transform via launch files.</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;launch&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">pkg=</span><span class="s">"tf"</span> <span class="na">type=</span><span class="s">"static_transform_publisher"</span> <span class="na">name=</span><span class="s">"name_of_node"</span> 
          <span class="na">args=</span><span class="s">"x y z yaw pitch roll frame_id child_frame_id period_in_ms"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/node&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="extra-content">Extra Content</h2>
<h3 id="spawn-a-urdf-model-in-gazebo">Spawn a URDF Model in gazebo</h3>
<p>This is an example of a launch file you could use to spawn URDF models into a Gazebo world:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;launch&gt;</span>

    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"x"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"y"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"z"</span> <span class="na">default=</span><span class="s">"0.0"</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"urdf_robot_file"</span> <span class="na">default=</span><span class="s">"$(find your_pkg)/urdf/your_robot.urdf"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"robot_name"</span> <span class="na">default=</span><span class="s">"your_robot_model_name"</span> <span class="nt">/&gt;</span>


    <span class="c">&lt;!-- Load the URDF into the ROS Parameter Server --&gt;</span>
    <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"robot_description"</span> <span class="na">command=</span><span class="s">"cat $(arg urdf_robot_file)"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- Run a python script to the send a service call to gazebo_ros to spawn a URDF robot --&gt;</span>
    <span class="nt">&lt;node</span> <span class="na">name=</span><span class="s">"urdf_spawner"</span> <span class="na">pkg=</span><span class="s">"gazebo_ros"</span> <span class="na">type=</span><span class="s">"spawn_model"</span> <span class="na">respawn=</span><span class="s">"false"</span> <span class="na">output=</span><span class="s">"screen"</span>
    <span class="na">args=</span><span class="s">"-urdf -x $(arg x) -y $(arg y) -z $(arg z)  -model $(arg robot_name) -param robot_description"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/launch&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="delete-a-model-from-gazebo">Delete a model from gazebo</h3>
<p><strong>To get a list of all the current models in gazebo:</strong></p>

<p><code class="language-plaintext highlighter-rouge">osservice call /gazebo/get_world_properties "{}"</code></p>

<p><strong>To delete a paticular model from the above list:</strong></p>

<p><code class="language-plaintext highlighter-rouge">rosservice call /gazebo/delete_model "model_name: 'your_robot_model_name'"</code></p>

</div><section class="article__sharing d-print-none"><!-- Addthis BEGIN --><script type="text/javascript"
    src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-60e523a6b5396709"></script>
  <div class="addthis_inline_share_toolbox addthis_default_style"></div><!-- Addthis END -->
</section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2021-05-04T16:17:25+05:30"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/site/projects/2021-05-04-ROS-DUMMY.html">Dummy Page</a></div></div></div>

</div>
<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>

<h4>Related Posts</h4>
<!--Projects Related Posts-->

<div class="row">
<div class="relatedPosts">
    
    
    
    
    
    
    
    
    <div class="column">
      <div>
      <h5><a href="/site/projects/2021-05-04-ROS-Baiscs.html">
        <div class="card">
            <div class="card__image">
              <img class="image" src="/site/assets/images/fish.jpg"/>
            </div>
            <div class="card__content">
              <div class="card__header">
                <h4>ROS Basics</h4>
              </div>
              <p>rostopicsservicesactionspackageslaunch</p>
            </div>
          </div>
      </a>
      </h5>
      </div>
    </div>
      
      
    
 
    
    
    
    
    <div class="column">
      <div>
      <h5><a href="/site/projects/2021-05-04-ROS-DUMMY.html">
        <div class="card">
            <div class="card__image">
              <img class="image" src="/site/assets/images/fish.jpg"/>
            </div>
            <div class="card__content">
              <div class="card__header">
                <h4>Dummy Page</h4>
              </div>
              <p>ros</p>
            </div>
          </div>
      </a>
      </h5>
      </div>
    </div>
      
      
    
 
    
    
    
    
 
</div>
</div>


<!-- Resources Related Posts
 -->

<!--Blog Related Posts-->



<style>
  * {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

/* Float four columns side by side */
.column {
  float: left;
  width: 25%;
  padding: 0 10px;
}

/* Remove extra left and right margins, due to padding in columns */
.row {margin: 0 -5px;}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

/* Style the counter cards */
.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2); /* this adds the "card" effect */
  padding: 16px;
  text-align: center;
  background-color: #121212;
}

/* Responsive columns - one column layout (vertical) on small screens */
@media screen and (max-width: 600px) {
  .column {
    width: 100%;
    display: block;
    margin-bottom: 20px;
  }
}
</style>

<script src="https://utteranc.es/client.js"
        repo="arc-bphc/arc-bphc.github.io"
        issue-term="title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Automation  & Robotics Club"><meta itemprop="url" content="https://arc-bphc.github.io"><meta itemprop="description" content="I am an amazing person."><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://arc-bphc.github.io"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:arc@hyderabad.bits-pilani.ac.in" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Facebook.">
        <a class="button button--circle facebook-button" itemprop="sameAs" href="https://www.facebook.com/automationandroboticsclub" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M767.428571 6.857143l0 150.857143-89.714286 0q-49.142857 0-66.285714 20.571429t-17.142857 61.714286l0 108 167.428571 0-22.285714 169.142857-145.142857 0 0 433.714286-174.857143 0 0-433.714286-145.714286 0 0-169.142857 145.714286 0 0-124.571429q0-106.285714 59.428571-164.857143t158.285714-58.571429q84 0 130.285714 6.857143z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/arc-bphc" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Automation & Robotics Club 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>



